<template>
  <div class="grid grid-cols-1 lg:grid-cols-[1fr_400px] gap-4 overflow-hidden pb-4">
    <!-- Main Content -->
    <div class="space-y-6">
      <!-- Game Title -->
      <h1 class="text-4xl font-bold">{{ overview?.name }}</h1>

      <!-- Stat Cards -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <StatCard title="Price" :value="`$${overview?.price}`" bgClass="#73B0FF66">
          <template #icon>
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M43.032 12.608L47.912 17.488C55.0827 24.6613 58.6667 28.2453 58.6667 32.6987C58.6667 37.1547 55.0827 40.7387 47.912 47.9093C40.7387 55.0827 37.1547 58.6667 32.6987 58.6667C28.2453 58.6667 24.6587 55.0827 17.488 47.912L12.608 43.032C8.48799 38.9093 6.42666 36.8507 5.66132 34.176C4.89332 31.5013 5.54932 28.6613 6.86132 22.984L7.61599 19.7093C8.71732 14.9307 9.26932 12.5413 10.904 10.904C12.5387 9.26666 14.9307 8.71733 19.7093 7.61599L22.984 6.85866C28.664 5.54933 31.5013 4.89333 34.176 5.65866C36.8507 6.42666 38.912 8.48799 43.032 12.608ZM29.7227 38.208C27.928 36.416 27.9413 33.84 29.016 31.8C28.7499 31.4157 28.6269 30.9504 28.6682 30.4848C28.7095 30.0193 28.9125 29.5829 29.2421 29.2514C29.5716 28.92 30.0068 28.7144 30.4722 28.6704C30.9375 28.6264 31.4035 28.7468 31.7893 29.0107C32.696 28.5307 33.6907 28.2747 34.6827 28.2853C35.2131 28.2903 35.7198 28.5057 36.0914 28.8843C36.463 29.2629 36.6689 29.7736 36.664 30.304C36.659 30.8344 36.4436 31.3412 36.065 31.7127C35.6864 32.0843 35.1758 32.2903 34.6453 32.2853C34.0279 32.3081 33.4443 32.5736 33.0213 33.024C31.9893 34.056 32.2587 35.0907 32.5493 35.3813C32.8427 35.672 33.8747 35.9413 34.9067 34.9093C36.9973 32.8187 40.608 32.1253 42.92 34.4373C44.7147 36.232 44.7013 38.808 43.6267 40.848C43.891 41.2324 44.0127 41.697 43.9707 42.1617C43.9286 42.6263 43.7255 43.0616 43.3964 43.3922C43.0673 43.7229 42.633 43.9281 42.1686 43.9724C41.7042 44.0166 41.239 43.8972 40.8533 43.6347C39.6567 44.2912 38.2686 44.51 36.928 44.2533C36.4082 44.1465 35.9521 43.8376 35.66 43.3945C35.3679 42.9514 35.2639 42.4105 35.3707 41.8907C35.4775 41.3708 35.7864 40.9147 36.2295 40.6227C36.6725 40.3306 37.2135 40.2265 37.7333 40.3333C38.2053 40.432 38.968 40.2773 39.6213 39.624C40.6533 38.5893 40.384 37.5573 40.0933 37.2667C39.8 36.976 38.768 36.7067 37.736 37.7387C35.6453 39.8293 32.0347 40.5227 29.7227 38.208ZM26.72 27.448C27.2152 26.9526 27.6079 26.3646 27.8758 25.7175C28.1438 25.0704 28.2816 24.3768 28.2815 23.6764C28.2813 22.976 28.1433 22.2825 27.8751 21.6354C27.607 20.9884 27.214 20.4005 26.7187 19.9053C26.2233 19.4102 25.6353 19.0174 24.9881 18.7495C24.341 18.4816 23.6474 18.3437 22.947 18.3439C22.2466 18.344 21.5531 18.4821 20.9061 18.7502C20.259 19.0184 19.6712 19.4113 19.176 19.9067C18.1759 20.9071 17.6143 22.2637 17.6145 23.6783C17.6148 25.0928 18.1769 26.4493 19.1773 27.4493C20.1777 28.4494 21.5344 29.011 22.9489 29.0108C24.3635 29.0105 25.7199 28.4484 26.72 27.448Z" fill="white"/>
            </svg>
          </template>
        </StatCard>
        <StatCard title="Downloads" :value="downloadsFormatted" bgClass="#FF73E166">
          <template #icon>
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M32 8C32.6532 8.00009 33.2836 8.23988 33.7717 8.67391C34.2598 9.10793 34.5716 9.706 34.648 10.3547L34.6667 10.6667V13.3333H38.6667C43.914 13.3347 48.9506 15.3982 52.6905 19.0789C56.4304 22.7596 58.574 27.7627 58.659 33.0093C58.744 38.2559 56.7637 43.3258 53.145 47.1258C49.5263 50.9257 44.5592 53.1513 39.3147 53.3227L38.6667 53.3333H25.3334C20.086 53.332 15.0494 51.2685 11.3095 47.5878C7.56964 43.9071 5.42609 38.904 5.34107 33.6574C5.25605 28.4107 7.23638 23.3409 10.855 19.5409C14.4737 15.7409 19.4408 13.5153 24.6854 13.344L25.3334 13.3333H29.3334V10.6667C29.3334 9.95942 29.6143 9.28115 30.1144 8.78105C30.6145 8.28095 31.2928 8 32 8ZM41.3334 26.6667C40.6261 26.6667 39.9478 26.9476 39.4477 27.4477C38.9476 27.9478 38.6667 28.6261 38.6667 29.3333V30.6667H37.3334C36.6261 30.6667 35.9478 30.9476 35.4477 31.4477C34.9476 31.9478 34.6667 32.6261 34.6667 33.3333C34.6667 34.0406 34.9476 34.7189 35.4477 35.2189C35.9478 35.719 36.6261 36 37.3334 36H38.6667V37.3333C38.6667 38.0406 38.9476 38.7189 39.4477 39.2189C39.9478 39.719 40.6261 40 41.3334 40C42.0406 40 42.7189 39.719 43.219 39.2189C43.7191 38.7189 44 38.0406 44 37.3333V36H45.3334C46.0406 36 46.7189 35.719 47.219 35.2189C47.7191 34.7189 48 34.0406 48 33.3333C48 32.6261 47.7191 31.9478 47.219 31.4477C46.7189 30.9476 46.0406 30.6667 45.3334 30.6667H44V29.3333C44 28.6261 43.7191 27.9478 43.219 27.4477C42.7189 26.9476 42.0406 26.6667 41.3334 26.6667ZM22.6667 26.6667C20.8986 26.6667 19.2029 27.369 17.9526 28.6193C16.7024 29.8695 16 31.5652 16 33.3333C16 35.1014 16.7024 36.7971 17.9526 38.0474C19.2029 39.2976 20.8986 40 22.6667 40C24.4348 40 26.1305 39.2976 27.3807 38.0474C28.631 36.7971 29.3334 35.1014 29.3334 33.3333C29.3334 31.5652 28.631 29.8695 27.3807 28.6193C26.1305 27.369 24.4348 26.6667 22.6667 26.6667ZM22.6667 32C23.0203 32 23.3594 32.1405 23.6095 32.3905C23.8595 32.6406 24 32.9797 24 33.3333C24 33.687 23.8595 34.0261 23.6095 34.2761C23.3594 34.5262 23.0203 34.6667 22.6667 34.6667C22.3131 34.6667 21.9739 34.5262 21.7239 34.2761C21.4738 34.0261 21.3334 33.687 21.3334 33.3333C21.3334 32.9797 21.4738 32.6406 21.7239 32.3905C21.9739 32.1405 22.3131 32 22.6667 32Z" fill="white"/>
            </svg>
          </template>
        </StatCard>
        <StatCard title="Revenue" :value="revenueFormatted" bgClass="#FF737666">
          <template #icon>
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M32.0521 8C26.0294 8 20.5427 9.98933 17.2961 11.6147C17.0027 11.7613 16.7289 11.9044 16.4747 12.044C15.9707 12.3187 15.5414 12.5747 15.2001 12.8L18.8934 18.2373L20.6321 18.9293C27.4267 22.3573 36.5387 22.3573 43.3347 18.9293L45.3081 17.9053L48.8001 12.8C48.0759 12.3295 47.3239 11.9034 46.5481 11.524C43.3174 9.916 37.9614 8 32.0534 8M23.4641 14.1547C22.1565 13.9086 20.8649 13.5845 19.5961 13.184C22.6374 11.8333 27.1694 10.4 32.0534 10.4C35.4361 10.4 38.6347 11.088 41.2801 11.96C38.1801 12.396 34.8721 13.136 31.7201 14.0467C29.2401 14.764 26.3414 14.6867 23.4641 14.1547ZM44.7441 20.9067L44.4161 21.072C36.9414 24.8427 27.0267 24.8427 19.5521 21.072L19.2414 20.9147C8.01072 33.236 -0.56261 55.996 32.0521 55.996C64.6667 55.996 55.8854 32.8133 44.7441 20.9067ZM30.6667 32C29.9595 32 29.2812 32.281 28.7811 32.781C28.281 33.2811 28.0001 33.9594 28.0001 34.6667C28.0001 35.3739 28.281 36.0522 28.7811 36.5523C29.2812 37.0524 29.9595 37.3333 30.6667 37.3333V32ZM33.3334 29.3333V28H30.6667V29.3333C29.2522 29.3333 27.8957 29.8952 26.8955 30.8954C25.8953 31.8956 25.3334 33.2522 25.3334 34.6667C25.3334 36.0812 25.8953 37.4377 26.8955 38.4379C27.8957 39.4381 29.2522 40 30.6667 40V45.3333C29.5067 45.3333 28.5187 44.5933 28.1507 43.556C28.0961 43.3863 28.008 43.2292 27.8917 43.0942C27.7753 42.9591 27.6331 42.8487 27.4733 42.7696C27.3136 42.6904 27.1396 42.6441 26.9616 42.6334C26.7837 42.6227 26.6054 42.6478 26.4373 42.7072C26.2692 42.7666 26.1147 42.8591 25.983 42.9792C25.8513 43.0993 25.745 43.2447 25.6704 43.4066C25.5958 43.5685 25.5545 43.7438 25.5488 43.922C25.5431 44.1001 25.5733 44.2777 25.6374 44.444C26.005 45.4841 26.6861 46.3846 27.5868 47.0214C28.4875 47.6583 29.5636 48.0002 30.6667 48V49.3333H33.3334V48C34.7479 48 36.1044 47.4381 37.1046 46.4379C38.1048 45.4377 38.6667 44.0812 38.6667 42.6667C38.6667 41.2522 38.1048 39.8956 37.1046 38.8954C36.1044 37.8952 34.7479 37.3333 33.3334 37.3333V32C34.4934 32 35.4814 32.74 35.8494 33.7773C35.904 33.947 35.9921 34.1041 36.1084 34.2392C36.2248 34.3742 36.367 34.4846 36.5268 34.5638C36.6865 34.6429 36.8605 34.6892 37.0385 34.6999C37.2164 34.7106 37.3947 34.6856 37.5628 34.6262C37.7309 34.5668 37.8854 34.4743 38.0171 34.3541C38.1489 34.234 38.2552 34.0887 38.3297 33.9267C38.4043 33.7648 38.4457 33.5896 38.4513 33.4114C38.457 33.2332 38.4269 33.0557 38.3627 32.8893C37.9951 31.8493 37.314 30.9488 36.4133 30.3119C35.5126 29.675 34.4365 29.3332 33.3334 29.3333ZM33.3334 40V45.3333C34.0406 45.3333 34.7189 45.0524 35.219 44.5523C35.7191 44.0522 36.0001 43.3739 36.0001 42.6667C36.0001 41.9594 35.7191 41.2811 35.219 40.7811C34.7189 40.281 34.0406 40 33.3334 40Z" fill="white"/>
            </svg>
          </template>
        </StatCard>
      </div>

      <!-- Performance and Description -->
      <div class="bg-white rounded-xl p-4">
        <PerformanceChart :chartData="performanceChartData" />
        <div class="bg-gray rounded-xl p-4">
          <DescriptionBlock :description="overview?.description" />
        </div>

      </div> 
    </div>

    <!-- Right Sidebar -->
    <div class="space-y-2 w-full w-[400px] pr-4">
      <!-- Short Description and Stream Performance -->
      <div class="bg-white rounded-xl p-6 h-auto">
        <h2 class="text-base font-semibold pb-2">Short Description</h2>
        <p class="text-xs text-gray-500 leading-relaxed break-words pb-3">{{ overview?.description }} {{ overview?.description }} {{ overview?.description }}</p>
         <StreamPerformance
            :streamCounts="stream?.dailyStreamCounts"
            :stats="stream"
          />
      </div>
    </div>
  </div>
</template>

<script setup>
import StatCard from '~/components/StatCard.vue'
import PerformanceChart from '~/components/PerformanceChart.vue'
import DescriptionBlock from '~/components/DescriptionBlock.vue'
import StreamPerformance from '~/components/StreamPerformance.vue'
import { useApi } from '~/composables/useApi'

const api = useApi()

const { data: overview } = await api.getOverview()
const { data: performance } = await api.getPerformance()
const { data: stream } = await api.getStream()

const performanceChartData = computed(() => {
  if (!performance.value) return { labels: [], datasets: [] }
  return {
    labels: performance.value.dates,
    datasets: [
      {
        label: 'Watch Time',
        data: performance.value.watchTime,
        fill: true,
        borderColor: 'rgb(59, 130, 246)',
        backgroundColor: 'rgba(59, 130, 246, 0.2)',
        tension: 0.4
      },
      {
        label: 'Engagement',
        data: performance.value.engagement,
        fill: true,
        borderColor: 'rgb(16, 185, 129)',
        backgroundColor: 'rgba(16, 185, 129, 0.2)',
        tension: 0.4
      }
    ]
  }
})

const downloadsFormatted = computed(() =>
  overview.value ? overview.value.downloads : ''
)

const revenueFormatted = computed(() =>
  overview.value ? `${overview.value.revenue}` : ''
)
</script>
